
This notebook presents a brief introduction to the mapping capabilities of R. First we will need to install a few packages: ggmap, sf, osmdata, and osrm which will allow us to retrieve and visualize spatial data. Warning: sf installation for MacOS or Linux requires a bit of extra work, please follow the instructions [here](https://github.com/r-spatial/sf).  


```R
install.packages("ggmap")
install.packages("osmdata")
install.packages("sf")
install.packages("osrm")
```

    Installing package into ‘/home/daniel/R/x86_64-pc-linux-gnu-library/3.4’
    (as ‘lib’ is unspecified)


The package ggmap is essentially an extension of ggplot; it enables you to plot a map as the background of a ggplot graph. The package sf (simple features) provides a set of functions to manipulate spatial vector data. The package osmdata provides the functionality to download and use data from OpenStreetMap(OSM). The package OSRM (OpenStreetMap-Based Routing service) allows users to calculate travel times and routed distances (km) based on OSM network data.


```R
library(tidyverse)
library(ggmap)
library(osmdata)
library(sf)
library(osrm)
```

    ── [1mAttaching packages[22m ─────────────────────────────────────── tidyverse 1.2.1 ──
    [32m✔[39m [34mggplot2[39m 3.2.0     [32m✔[39m [34mpurrr  [39m 0.3.2
    [32m✔[39m [34mtibble [39m 2.1.3     [32m✔[39m [34mdplyr  [39m 0.8.3
    [32m✔[39m [34mtidyr  [39m 0.8.3     [32m✔[39m [34mstringr[39m 1.4.0
    [32m✔[39m [34mreadr  [39m 1.3.1     [32m✔[39m [34mforcats[39m 0.4.0
    ── [1mConflicts[22m ────────────────────────────────────────── tidyverse_conflicts() ──
    [31m✖[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
    [31m✖[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
    Google's Terms of Service: https://cloud.google.com/maps-platform/terms/.
    Please cite ggmap if you use it! See citation("ggmap") for details.
    Data (c) OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright
    Linking to GEOS 3.7.1, GDAL 2.4.2, PROJ 5.2.0
    Data: (c) OpenStreetMap contributors, ODbL 1.0 - http://www.openstreetmap.org/copyright
    Routing: OSRM - http://project-osrm.org/


Before we actually build a query, we need to know what are the features that are available in OSM. For every feature there will also be a corresponding set of tags. Let's take a glimpse of some of the possibilities for features and tags related to the "amenity" feature. 



```R
available_features() %>% glimpse()
```

     chr [1:217] "4wd only" "abandoned" "abutters" "access" "addr" "addr:city" ...



```R
"amenity" %>% 
  available_tags() %>%
  glimpse()
```

     chr [1:108] "animal boarding" "animal shelter" "arts centre" "atm" ...


There are plenty of categories to choose from, now let's build a query. The getbb( ) function uses an API provided by OpenStreetMap (OSM) and returns a "bounding box" associated to a given place. opq() stands for "overpass query" and will allow us to build our query. Criteria is filtered using the add_osm_feature( ) function. Our query (q) will look for cinemas in Christchurch. add_osm_feature() takes two arguments, a feature (key="amenity") and a tag (value="cinema).


```R
q <- getbb("Christchurch")%>%
      opq()%>%
       add_osm_feature("amenity", "cinema")
```

What is stored inside of q? Our query is actually a list containing four character vectors including the geographhic coordinates of our bounding box, and our search criteria.  


```R
q %>% glimpse()
```

    List of 4
     $ bbox    : chr "-43.690955,172.4766455,-43.370955,172.7966455"
     $ prefix  : chr "[out:xml][timeout:25];\n(\n"
     $ suffix  : chr ");\n(._;>;);\nout body;"
     $ features: chr " [\"amenity\"=\"cinema\"]"
     - attr(*, "class")= chr [1:2] "list" "overpass_query"


Let's begin to extract some data. The osmdata_*( ) function sends the query to the server and, depending on the suffix * sf/sp/xml, returns a simple feature, spatial or XML format. A simple feature is standard file that used to access and work with one or two-dimensional geometries (point, line, and polygon) used in Geographic Information Systems. Let's try to extract the data in the form of a simple feature, what is stored inside of cinema?


```R
cinema <- q %>% 
  osmdata_sf()
```


```R
cinema %>% glimpse()
```

    List of 8
     $ bbox             : chr "-43.690955,172.4766455,-43.370955,172.7966455"
     $ overpass_call    : chr "[out:xml][timeout:25];\n(\n node  [\"amenity\"=\"cinema\"] (-43.690955,172.4766455,-43.370955,172.7966455);\n w"| __truncated__
     $ meta             :List of 3
      ..$ timestamp       : chr "[ Tue 3 Sep 2019 21:21:02 ]"
      ..$ OSM_version     : chr "0.6"
      ..$ overpass_version: chr "Overpass API 0.7.55.7 8b86ff77"
     $ osm_points       :Classes ‘sf’ and 'data.frame':	20 obs. of  16 variables:
      ..$ osm_id            : chr [1:20] "362887434" "1150574409" "1160428371" "1169883994" ...
      ..$ name              : chr [1:20] NA "Reading Cinemas" "Hoyts Cinema" NA ...
      ..$ addr.city         : chr [1:20] NA "Christchurch" "Christchurch" NA ...
      ..$ addr.street       : chr [1:20] NA "Marshland Road" "Main North Road" NA ...
      ..$ alt_name          : chr [1:20] NA NA "Hoyts 6" NA ...
      ..$ amenity           : chr [1:20] NA "cinema" "cinema" NA ...
      ..$ branch            : chr [1:20] NA "The Plams" "Papanui" NA ...
      ..$ brand             : chr [1:20] NA NA NA NA ...
      ..$ brand.wikidata    : chr [1:20] NA NA NA NA ...
      ..$ brand.wikipedia   : chr [1:20] NA NA NA NA ...
      ..$ note              : chr [1:20] NA NA NA NA ...
      ..$ phone.NZ          : chr [1:20] NA NA NA NA ...
      ..$ toilets.wheelchair: chr [1:20] NA NA "yes" NA ...
      ..$ website           : chr [1:20] NA NA "http://www.hoyts.co.nz/cinemas/locations/hoyts_northlands.aspx#session" NA ...
      ..$ wheelchair        : chr [1:20] NA NA "yes" NA ...
      ..$ geometry          :sfc_POINT of length 20; first list element: Classes 'XY', 'POINT', 'sfg'  num [1:2] 172.8 -43.6
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:15] "osm_id" "name" "addr.city" "addr.street" ...
     $ osm_lines        : NULL
     $ osm_polygons     :Classes ‘sf’ and 'data.frame':	3 obs. of  21 variables:
      ..$ osm_id          : chr [1:3] "297852002" "400678638" "406854457"
      ..$ name            : chr [1:3] "Alice Cinematheque" "Hollywood 3 Cinema" "Alice's Deluxe Cinemas"
      ..$ addr.city       : chr [1:3] NA "Christchurch" NA
      ..$ addr.country    : chr [1:3] NA "NZ" NA
      ..$ addr.housenumber: chr [1:3] NA "28" NA
      ..$ addr.place      : chr [1:3] NA "Sumner" NA
      ..$ addr.postcode   : chr [1:3] NA "8081" NA
      ..$ addr.street     : chr [1:3] NA "Marriner Street" NA
      ..$ amenity         : chr [1:3] "cinema" "cinema" "cinema"
      ..$ area            : chr [1:3] "yes" NA NA
      ..$ building        : chr [1:3] NA "commercial" "yes"
      ..$ building.levels : chr [1:3] NA NA "2"
      ..$ cinema.3D       : chr [1:3] NA "no" NA
      ..$ drive_in        : chr [1:3] NA "no" NA
      ..$ email           : chr [1:3] NA "mascinemas@xtra.co.nz" NA
      ..$ phone           : chr [1:3] NA "+64 3 326 6102" NA
      ..$ screen          : chr [1:3] NA NA "2"
      ..$ source.geometry : chr [1:3] NA "LINZ" "LINZ"
      ..$ website         : chr [1:3] "http://cinematheque.aliceinvideoland.co.nz" "https://www.hollywoodcinema.co.nz" NA
      ..$ wikidata        : chr [1:3] NA "Q37175939" NA
      ..$ geometry        :sfc_POLYGON of length 3; first list element: List of 1
      .. ..$ : num [1:5, 1:2] 173 173 173 173 173 ...
      .. .. ..- attr(*, "dimnames")=List of 2
      .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:20] "osm_id" "name" "addr.city" "addr.country" ...
     $ osm_multilines   : NULL
     $ osm_multipolygons: NULL
     - attr(*, "class")= chr [1:3] "list" "osmdata" "osmdata_sf"


The result is a list of different objects, including simple feature classes and we are going to use ggplot's geom_sf() function to visualize them. geom_sf() uses a geometry object as its unique aesthetic, so in order to avoid conflicts with the default plot specification we set inherit.aes to FALSE, please have a look at the documentation [here](https://ggplot2.tidyverse.org/reference/ggsf.html). 
The two main plotting features of ggmap are the get_map() function, which downloads a background map from a specified map provider (i.e Google Maps, OSM, Stamen Maps), and the ggmap() function that plots the raster map provided by get_map(). If you want to get familiar with GIS terminology you can read about it [here](https://gisgeography.com/spatial-data-types-vector-raster/). Notice the maptype argument for ggmap; it allows to specify the map theme, and options available include: "satellite","terrain", "hybrid", etc.  Once a map is downloaded and plotted, it is then possible to use the normal grammar of gglot to visually represent that data on the map.


```R
chc_map <- "Christchurch" %>%
  getbb() %>%
  get_map(source = "stamen", maptype = "toner")
```

    Source : http://tile.stamen.com/terrain/12/4010/2596.png
    Source : http://tile.stamen.com/terrain/12/4011/2596.png
    Source : http://tile.stamen.com/terrain/12/4012/2596.png
    Source : http://tile.stamen.com/terrain/12/4013/2596.png
    Source : http://tile.stamen.com/terrain/12/4014/2596.png
    Source : http://tile.stamen.com/terrain/12/4010/2597.png
    Source : http://tile.stamen.com/terrain/12/4011/2597.png
    Source : http://tile.stamen.com/terrain/12/4012/2597.png
    Source : http://tile.stamen.com/terrain/12/4013/2597.png
    Source : http://tile.stamen.com/terrain/12/4014/2597.png
    Source : http://tile.stamen.com/terrain/12/4010/2598.png
    Source : http://tile.stamen.com/terrain/12/4011/2598.png
    Source : http://tile.stamen.com/terrain/12/4012/2598.png
    Source : http://tile.stamen.com/terrain/12/4013/2598.png
    Source : http://tile.stamen.com/terrain/12/4014/2598.png
    Source : http://tile.stamen.com/terrain/12/4010/2599.png
    Source : http://tile.stamen.com/terrain/12/4011/2599.png
    Source : http://tile.stamen.com/terrain/12/4012/2599.png
    Source : http://tile.stamen.com/terrain/12/4013/2599.png
    Source : http://tile.stamen.com/terrain/12/4014/2599.png
    Source : http://tile.stamen.com/terrain/12/4010/2600.png
    Source : http://tile.stamen.com/terrain/12/4011/2600.png
    Source : http://tile.stamen.com/terrain/12/4012/2600.png
    Source : http://tile.stamen.com/terrain/12/4013/2600.png
    Source : http://tile.stamen.com/terrain/12/4014/2600.png
    Source : http://tile.stamen.com/terrain/12/4010/2601.png
    Source : http://tile.stamen.com/terrain/12/4011/2601.png
    Source : http://tile.stamen.com/terrain/12/4012/2601.png
    Source : http://tile.stamen.com/terrain/12/4013/2601.png
    Source : http://tile.stamen.com/terrain/12/4014/2601.png



```R
chc_map %>%
  ggmap()+
    geom_sf(data=cinema$osm_points,
          inherit.aes =FALSE,
          colour="green",
          fill="blue",
          alpha=.5,
          size=5,
          shape=25)+
  labs(x="Longitude",y="Latitude")
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_16_1.png)


There are other features available in OSM and they can be represented through other geometry types like lines. Let's create a new query and this time we will try to map cycle ways within Christchurch. 


```R
q_2 <- getbb("Christchurch")%>%
      opq()%>%
       add_osm_feature("cycleway", "lane")
cycleway <- q_2 %>% osmdata_sf()
```


```R
chc_map %>%
  ggmap()+
    geom_sf(data=cycleway$osm_lines,
          inherit.aes =FALSE,
          colour="blue",
          size=1) +
  labs(x="Longitude",y="Latitude")
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_19_1.png)


What if you wanted to find the shortest route between two points. The OSRM package that can take care of that. The osrmRoute gets the shortest path between two points, it sends a query and gets the geometry of a route. The main arguments are the origin and destination, and in our case we will be passing them as sf objects. We will use two cinema locations. The remaining arguments specify the level of resolution required for our geometry and the type of object to be returned, in our case we are interested in obtaining a simple feature class.  




```R
route <- osrmRoute(src=cinema$osm_points[1,],dst=cinema$osm_points[2,], 
                   overview="full", returnclass="sf")
str(route)
```

    Classes ‘sf’ and 'data.frame':	1 obs. of  5 variables:
     $ src     : Factor w/ 1 level "362887434": 1
     $ dst     : Factor w/ 1 level "1150574409": 1
     $ duration: num 21.5
     $ distance: num 13.4
     $ geometry:sfc_LINESTRING of length 1; first list element:  XY [1:458, 1:2] 173 173 173 173 173 ...
     - attr(*, "sf_column")= chr "geometry"
     - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA
      ..- attr(*, "names")= chr  "src" "dst" "duration" "distance"


Notice the contents of the route object, specifically, there are two variables containing the travel time in minutes and travel distance in kilometers. Let's plot our route. We will use ggmap as we did before.


```R
chc_map %>% ggmap() + geom_sf(data=route, inherit.aes = FALSE, colour ="blue") 
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_23_1.png)


Think of isochrones as polygons that represent areas that fall within a certain travel time from a given location. osrmIsochrone is a function that enables users to build isochrone maps. It takes the location of a given point and a vector that specifies the number and magnitude of "travel time" breaks. We also specify the number of additional points that will eb used to calculate the isochrones.     


```R
iso <- osrmIsochrone(loc = cinema$osm_points[2,], returnclass="sf", 
                    # breaks = seq(from = 0, to = 14, by = 2), res = 50)
str(iso)
```

    Classes ‘sf’ and 'data.frame':	7 obs. of  5 variables:
     $ id      : int  1 2 3 4 5 6 7
     $ min     : num  0 2 4 6 8 10 12
     $ max     : num  2 4 6 8 10 12 14
     $ geometry:sfc_MULTIPOLYGON of length 7; first list element: List of 1
      ..$ :List of 1
      .. ..$ : num [1:7, 1:2] 173 173 173 173 173 ...
      ..- attr(*, "class")= chr  "XY" "MULTIPOLYGON" "sfg"
     $ center  : num  1 3 5 7 9 11 13
     - attr(*, "sf_column")= chr "geometry"
     - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA
      ..- attr(*, "names")= chr  "id" "min" "max" "center"


Notice that our object iso contains a "center" variable which actually corresponds to travel times in minutes for different regions. We will use this variable within the aesthetics of geom_sf.


```R
chc_map %>% ggmap() + geom_sf(data = iso, aes(fill = center), alpha = 0.8, inherit.aes = FALSE) +
            geom_sf(data=cinema$osm_points[2,], color = "blue", size = 2, inherit.aes = FALSE)
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_27_1.png)


It is time to work on more interesting stuff. The fires in the Amazon have recently drawn a lot of media attention. NASA currently runs the Fire Information Resource Management System (FIRMS) and they have really interesting data that we can use for our exercise. The csv file is provided, however you can download the data yourself from [here](https://firms.modaps.eosdis.nasa.gov/active_fire/#firms-txt). The file we will be working with contains data on active fires in South America for the past 7 days. It contains the geographic coordinates of the fires along with other indicators such as the Fire Radiative Power (for more info, see previous link).   


```R
fire_data <- "https://firms.modaps.eosdis.nasa.gov/data/active_fire/viirs/csv/VNP14IMGTDL_NRT_South_America_7d.csv" %>%
  read_csv()
```

    Parsed with column specification:
    cols(
      latitude = [32mcol_double()[39m,
      longitude = [32mcol_double()[39m,
      bright_ti4 = [32mcol_double()[39m,
      scan = [32mcol_double()[39m,
      track = [32mcol_double()[39m,
      acq_date = [34mcol_date(format = "")[39m,
      acq_time = [31mcol_character()[39m,
      satellite = [31mcol_character()[39m,
      confidence = [31mcol_character()[39m,
      version = [31mcol_character()[39m,
      bright_ti5 = [32mcol_double()[39m,
      frp = [32mcol_double()[39m,
      daynight = [31mcol_character()[39m
    )



```R
fire_data %>% glimpse()
```

    Observations: 185,463
    Variables: 13
    $ latitude   [3m[38;5;246m<dbl>[39m[23m -24.26521, -24.27162, -24.60362, -24.60278, -24.72002, -24…
    $ longitude  [3m[38;5;246m<dbl>[39m[23m -51.40070, -51.39770, -51.14752, -51.15123, -50.87337, -50…
    $ bright_ti4 [3m[38;5;246m<dbl>[39m[23m 300.1, 299.9, 343.2, 311.5, 306.6, 303.6, 331.5, 320.5, 30…
    $ scan       [3m[38;5;246m<dbl>[39m[23m 0.38, 0.38, 0.36, 0.36, 0.35, 0.35, 0.33, 0.55, 0.55, 0.55…
    $ track      [3m[38;5;246m<dbl>[39m[23m 0.59, 0.59, 0.57, 0.57, 0.56, 0.56, 0.55, 0.51, 0.51, 0.51…
    $ acq_date   [3m[38;5;246m<date>[39m[23m 2019-09-18, 2019-09-18, 2019-09-18, 2019-09-18, 2019-09-1…
    $ acq_time   [3m[38;5;246m<chr>[39m[23m "0354", "0354", "0354", "0354", "0354", "0354", "0354", "0…
    $ satellite  [3m[38;5;246m<chr>[39m[23m "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…
    $ confidence [3m[38;5;246m<chr>[39m[23m "nominal", "nominal", "nominal", "nominal", "nominal", "no…
    $ version    [3m[38;5;246m<chr>[39m[23m "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT"…
    $ bright_ti5 [3m[38;5;246m<dbl>[39m[23m 289.9, 289.9, 291.8, 289.4, 290.0, 290.9, 289.5, 289.7, 28…
    $ frp        [3m[38;5;246m<dbl>[39m[23m 1.0, 0.6, 2.9, 2.9, 1.5, 1.1, 2.0, 3.2, 1.6, 3.5, 3.5, 3.7…
    $ daynight   [3m[38;5;246m<chr>[39m[23m "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…


That is a lot of information as it contains records for South America. We want to narrow down the assessment to the region of MATO GROSSO which is one of the areas that has been affected recently. We can get the bounding box for that region. getbb actually returns a matrix with the coordinates of our bounding box.


```R
MG_bb <- "STATE OF MATO GROSSO" %>%
  getbb()
MG_bb
```


<table>
<caption>A matrix: 2 × 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>min</th><th scope=col>max</th></tr>
</thead>
<tbody>
	<tr><th scope=row>x</th><td>-61.63300</td><td>-50.207568</td></tr>
	<tr><th scope=row>y</th><td>-18.04156</td><td> -7.348293</td></tr>
</tbody>
</table>



Now we can filter our dataset using the coordinates from our bounding box, and we only include observations with a high level of confidence. 


```R
fire_data_MG <- fire_data %>% 
  filter(longitude > -61.63, longitude < -50.21) %>%
  filter(latitude > -18.04, latitude < -7.35) %>%
  filter(confidence == "high")
```


```R
fire_data_MG %>% glimpse()
```

    Observations: 3,224
    Variables: 13
    $ latitude   [3m[38;5;246m<dbl>[39m[23m -13.20570, -13.20692, -13.22417, -16.16123, -16.16292, -17…
    $ longitude  [3m[38;5;246m<dbl>[39m[23m -51.20193, -51.19616, -51.21226, -53.68872, -53.68655, -50…
    $ bright_ti4 [3m[38;5;246m<dbl>[39m[23m 367, 367, 367, 367, 367, 367, 367, 367, 367, 367, 367, 367…
    $ scan       [3m[38;5;246m<dbl>[39m[23m 0.61, 0.61, 0.62, 0.77, 0.77, 0.45, 0.45, 0.54, 0.63, 0.63…
    $ track      [3m[38;5;246m<dbl>[39m[23m 0.71, 0.71, 0.71, 0.77, 0.77, 0.63, 0.63, 0.67, 0.72, 0.72…
    $ acq_date   [3m[38;5;246m<date>[39m[23m 2019-09-18, 2019-09-18, 2019-09-18, 2019-09-18, 2019-09-1…
    $ acq_time   [3m[38;5;246m<chr>[39m[23m "0348", "0348", "0348", "0348", "0348", "0348", "0348", "0…
    $ satellite  [3m[38;5;246m<chr>[39m[23m "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…
    $ confidence [3m[38;5;246m<chr>[39m[23m "high", "high", "high", "high", "high", "high", "high", "h…
    $ version    [3m[38;5;246m<chr>[39m[23m "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT", "1.0NRT"…
    $ bright_ti5 [3m[38;5;246m<dbl>[39m[23m 295.2, 296.4, 296.6, 293.4, 295.1, 297.3, 306.1, 297.2, 29…
    $ frp        [3m[38;5;246m<dbl>[39m[23m 10.7, 10.7, 10.5, 16.2, 19.8, 6.1, 33.4, 7.9, 14.6, 19.9, …
    $ daynight   [3m[38;5;246m<chr>[39m[23m "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…


Now we convert our data frame into an sf (simple feature) object that aside the original columns will have an additional geometry component. Then, with st_crs, we assign a geographic coordinate system, in our case we use WGS84 (World Geodetic Survey 1984). If you want to learn more about coordinate systems and projections, please go [here](http://resources.esri.com/help/9.3/arcgisengine/dotnet/89b720a5-7339-44b0-8b58-0f5bf2843393.htm) 


```R
fire_MG_sf <- fire_data_MG %>%
  st_as_sf(coords=c("longitude","latitude"))
```


```R
st_crs(fire_MG_sf)
```


    Coordinate Reference System: NA



```R
st_crs(fire_MG_sf) <- 4326
st_crs(fire_MG_sf)
```


    Coordinate Reference System:
      EPSG: 4326 
      proj4string: "+proj=longlat +datum=WGS84 +no_defs"



```R
str(fire_MG_sf)
```

    Classes ‘sf’, ‘tbl_df’, ‘tbl’ and 'data.frame':	3224 obs. of  12 variables:
     $ bright_ti4: num  367 367 367 367 367 367 367 367 367 367 ...
     $ scan      : num  0.61 0.61 0.62 0.77 0.77 0.45 0.45 0.54 0.63 0.63 ...
     $ track     : num  0.71 0.71 0.71 0.77 0.77 0.63 0.63 0.67 0.72 0.72 ...
     $ acq_date  : Date, format: "2019-09-18" "2019-09-18" ...
     $ acq_time  : chr  "0348" "0348" "0348" "0348" ...
     $ satellite : chr  "N" "N" "N" "N" ...
     $ confidence: chr  "high" "high" "high" "high" ...
     $ version   : chr  "1.0NRT" "1.0NRT" "1.0NRT" "1.0NRT" ...
     $ bright_ti5: num  295 296 297 293 295 ...
     $ frp       : num  10.7 10.7 10.5 16.2 19.8 6.1 33.4 7.9 14.6 19.9 ...
     $ daynight  : chr  "N" "N" "N" "N" ...
     $ geometry  :sfc_POINT of length 3224; first list element: Classes 'XY', 'POINT', 'sfg'  num [1:2] -51.2 -13.2
     - attr(*, "sf_column")= chr "geometry"
     - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      ..- attr(*, "names")= chr  "bright_ti4" "scan" "track" "acq_date" ...


Note the additional geometry list-column which holds the coordinates of all of our points. Let's extract some more data. As you have seen previously, OSM uses lots of features and tags to describe different things within a given area. For this particular example, we are interested in land use, more specifically on farmland and protected areas. Let's build a few queries upon these ideas. Let's start by using "landuse" as a key and "farmland" as a tag.


```R
q_fm <- MG_bb %>%
      opq() %>%
      add_osm_feature("landuse", "farmland")
MG_farmland <- q_fm %>% osmdata_sf()
```


```R
MG_farmland %>% glimpse()
```

    List of 8
     $ bbox             : chr "-18.0415597,-61.633,-7.3482932,-50.2075677"
     $ overpass_call    : chr "[out:xml][timeout:25];\n(\n node  [\"landuse\"=\"farmland\"] (-18.0415597,-61.633,-7.3482932,-50.2075677);\n wa"| __truncated__
     $ meta             :List of 3
      ..$ timestamp       : chr "[ Thu 5 Sep 2019 00:18:03 ]"
      ..$ OSM_version     : chr "0.6"
      ..$ overpass_version: chr "Overpass API 0.7.55.7 8b86ff77"
     $ osm_points       :Classes ‘sf’ and 'data.frame':	30783 obs. of  10 variables:
      ..$ osm_id     : chr [1:30783] "346397126" "346399370" "346402337" "346793505" ...
      ..$ name       : chr [1:30783] NA NA NA NA ...
      ..$ addr.street: chr [1:30783] NA NA NA NA ...
      ..$ destination: chr [1:30783] NA NA NA NA ...
      ..$ junction   : chr [1:30783] NA NA NA NA ...
      ..$ landuse    : chr [1:30783] NA NA NA NA ...
      ..$ owner      : chr [1:30783] NA NA NA NA ...
      ..$ power      : chr [1:30783] NA NA NA NA ...
      ..$ source     : chr [1:30783] "IBGE" "IBGE" "IBGE" "IBGE" ...
      ..$ geometry   :sfc_POINT of length 30783; first list element: Classes 'XY', 'POINT', 'sfg'  num [1:2] -58.23 -9.33
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA
      .. ..- attr(*, "names")= chr [1:9] "osm_id" "name" "addr.street" "destination" ...
     $ osm_lines        :Classes ‘sf’ and 'data.frame':	84 obs. of  21 variables:
      ..$ osm_id      : chr [1:84] "170782956" "319927433" "319927435" "319927436" ...
      ..$ name        : chr [1:84] NA NA NA NA ...
      ..$ addr.country: chr [1:84] NA NA NA NA ...
      ..$ agricultural: chr [1:84] NA NA NA NA ...
      ..$ area        : chr [1:84] NA NA NA NA ...
      ..$ area_ha     : chr [1:84] NA NA NA NA ...
      ..$ crop        : chr [1:84] NA NA NA NA ...
      ..$ description : chr [1:84] NA NA NA NA ...
      ..$ farmland    : chr [1:84] NA NA NA NA ...
      ..$ highway     : chr [1:84] NA NA NA NA ...
      ..$ landcover   : chr [1:84] NA NA NA NA ...
      ..$ landuse     : chr [1:84] NA NA NA NA ...
      ..$ natural     : chr [1:84] NA NA NA NA ...
      ..$ note        : chr [1:84] NA NA NA NA ...
      ..$ objectid    : chr [1:84] NA NA NA NA ...
      ..$ operator    : chr [1:84] NA NA NA NA ...
      ..$ shape_area  : chr [1:84] NA NA NA NA ...
      ..$ shape_leng  : chr [1:84] NA NA NA NA ...
      ..$ source      : chr [1:84] NA NA NA NA ...
      ..$ source.image: chr [1:84] NA NA NA NA ...
      ..$ geometry    :sfc_LINESTRING of length 84; first list element:  XY [1:113, 1:2] -61 -61 -61 -61 -61 ...
      .. ..- attr(*, "dimnames")=List of 2
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:20] "osm_id" "name" "addr.country" "agricultural" ...
     $ osm_polygons     :Classes ‘sf’ and 'data.frame':	1371 obs. of  21 variables:
      ..$ osm_id      : chr [1:1371] "40697914" "40697936" "40697960" "170603166" ...
      ..$ name        : chr [1:1371] NA NA NA NA ...
      ..$ addr.country: chr [1:1371] "BO" "BO" "BO" NA ...
      ..$ agricultural: chr [1:1371] NA NA NA NA ...
      ..$ area        : chr [1:1371] NA NA NA NA ...
      ..$ area_ha     : chr [1:1371] NA NA NA NA ...
      ..$ crop        : chr [1:1371] NA NA NA NA ...
      ..$ description : chr [1:1371] NA NA NA NA ...
      ..$ farmland    : chr [1:1371] NA NA NA NA ...
      ..$ highway     : chr [1:1371] NA NA NA NA ...
      ..$ landcover   : chr [1:1371] NA NA NA NA ...
      ..$ landuse     : chr [1:1371] "farmland" "farmland" "farmland" NA ...
      ..$ natural     : chr [1:1371] NA NA NA "water" ...
      ..$ note        : chr [1:1371] NA NA NA NA ...
      ..$ objectid    : chr [1:1371] NA NA NA NA ...
      ..$ operator    : chr [1:1371] NA NA NA NA ...
      ..$ shape_area  : chr [1:1371] NA NA NA NA ...
      ..$ shape_leng  : chr [1:1371] NA NA NA NA ...
      ..$ source      : chr [1:1371] NA NA NA NA ...
      ..$ source.image: chr [1:1371] NA NA NA NA ...
      ..$ geometry    :sfc_POLYGON of length 1371; first list element: List of 1
      .. ..$ : num [1:21, 1:2] -60.6 -60.6 -60.6 -60.6 -60.6 ...
      .. .. ..- attr(*, "dimnames")=List of 2
      .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:20] "osm_id" "name" "addr.country" "agricultural" ...
     $ osm_multilines   : NULL
     $ osm_multipolygons:Classes ‘sf’ and 'data.frame':	41 obs. of  6 variables:
      ..$ description: chr [1:41] "" "" "" "" ...
      ..$ landuse    : chr [1:41] "farmland" "farmland" "farmland" "farmland" ...
      ..$ note       : chr [1:41] "" "" "" "" ...
      ..$ source     : chr [1:41] "" "" "" "" ...
      ..$ type       : chr [1:41] "multipolygon" "multipolygon" "multipolygon" "multipolygon" ...
      ..$ geometry   :sfc_MULTIPOLYGON of length 41; first list element: List of 1
      .. ..$ :List of 5
      .. ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA
      .. ..- attr(*, "names")= chr [1:5] "description" "landuse" "note" "source" ...
     - attr(*, "class")= chr [1:3] "list" "osmdata" "osmdata_sf"


For the next query we use "boundary" as a key and "protected area" as a tag.


```R
q_pa <- MG_bb %>%
      opq() %>%
       add_osm_feature("boundary","protected_area")
MG_protected <- q_pa %>% osmdata_sf()
```


```R
MG_protected %>% glimpse()
```

    List of 8
     $ bbox             : chr "-18.0415597,-61.633,-7.3482932,-50.2075677"
     $ overpass_call    : chr "[out:xml][timeout:25];\n(\n node  [\"boundary\"=\"protected_area\"] (-18.0415597,-61.633,-7.3482932,-50.2075677"| __truncated__
     $ meta             :List of 3
      ..$ timestamp       : chr "[ Thu 5 Sep 2019 00:18:03 ]"
      ..$ OSM_version     : chr "0.6"
      ..$ overpass_version: chr "Overpass API 0.7.55.7 8b86ff77"
     $ osm_points       :Classes ‘sf’ and 'data.frame':	189078 obs. of  25 variables:
      ..$ osm_id          : chr [1:189078] "96447745" "318915326" "318915904" "318915905" ...
      ..$ name            : chr [1:189078] NA NA NA NA ...
      ..$ addr.street     : chr [1:189078] NA NA NA NA ...
      ..$ alt_name        : chr [1:189078] NA NA NA NA ...
      ..$ amenity         : chr [1:189078] NA NA NA NA ...
      ..$ bus             : chr [1:189078] NA NA NA NA ...
      ..$ crossing        : chr [1:189078] NA NA NA NA ...
      ..$ description     : chr [1:189078] NA NA NA NA ...
      ..$ fixme           : chr [1:189078] NA NA NA NA ...
      ..$ ford            : chr [1:189078] NA NA NA NA ...
      ..$ highway         : chr [1:189078] NA NA NA NA ...
      ..$ historic        : chr [1:189078] NA NA NA NA ...
      ..$ man_made        : chr [1:189078] NA NA NA NA ...
      ..$ name.pt         : chr [1:189078] NA NA NA NA ...
      ..$ natural         : chr [1:189078] NA NA NA NA ...
      ..$ noexit          : chr [1:189078] NA NA NA NA ...
      ..$ note            : chr [1:189078] NA NA NA NA ...
      ..$ opening_hours   : chr [1:189078] NA NA NA NA ...
      ..$ public_transport: chr [1:189078] NA NA NA NA ...
      ..$ ref             : chr [1:189078] NA NA NA NA ...
      ..$ source          : chr [1:189078] NA NA NA NA ...
      ..$ start_date      : chr [1:189078] NA NA NA NA ...
      ..$ traffic_signals : chr [1:189078] NA NA NA NA ...
      ..$ waterway        : chr [1:189078] NA NA NA NA ...
      ..$ geometry        :sfc_POINT of length 189078; first list element: Classes 'XY', 'POINT', 'sfg'  num [1:2] -57.6 -18
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:24] "osm_id" "name" "addr.street" "alt_name" ...
     $ osm_lines        :Classes ‘sf’ and 'data.frame':	621 obs. of  82 variables:
      ..$ osm_id                 : chr [1:621] "31188586" "31191946" "31199251" "31199416" ...
      ..$ name                   : chr [1:621] "Rio dos Peixes" "Rio Aripuanã" "Rio Furquim" "Rio Amarelinho" ...
      ..$ FUNAI.ADR              : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.AREAETNO         : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.AREA_HA          : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.CDOC             : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.CODAREA          : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.DATADOC          : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.DOCUMENTO        : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.ETAPA            : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.EXTENSO          : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.FLUXO            : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.GID              : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.GRUPOS           : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.LINKAREA         : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.NOME_AREA        : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.PERIMETRO        : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.SITUACAO         : chr [1:621] NA NA NA NA ...
      ..$ FUNAI.TITULO           : chr [1:621] NA NA NA NA ...
      ..$ IBGE.CD_ADMINIS        : chr [1:621] NA NA NA NA ...
      ..$ IBGE.CD_CLASSE_        : chr [1:621] "Quarta Ordem" "Quinta Ordem" "Quarta Ordem" "Quarta Ordem" ...
      ..$ admin_level            : chr [1:621] NA NA NA NA ...
      ..$ alt_name               : chr [1:621] NA NA NA NA ...
      ..$ alt_source             : chr [1:621] NA NA NA NA ...
      ..$ area                   : chr [1:621] NA NA NA NA ...
      ..$ boat                   : chr [1:621] NA NA NA NA ...
      ..$ boundary               : chr [1:621] NA NA NA NA ...
      ..$ bridge                 : chr [1:621] NA NA NA NA ...
      ..$ description            : chr [1:621] NA NA NA NA ...
      ..$ destination            : chr [1:621] NA NA NA NA ...
      ..$ embankment             : chr [1:621] NA NA NA NA ...
      ..$ foot                   : chr [1:621] NA NA NA NA ...
      ..$ governance_type        : chr [1:621] NA NA NA NA ...
      ..$ highway                : chr [1:621] NA NA NA NA ...
      ..$ id_areas_e             : chr [1:621] NA NA NA NA ...
      ..$ int_name               : chr [1:621] NA NA NA NA ...
      ..$ intermittent           : chr [1:621] NA NA NA NA ...
      ..$ is_in.city             : chr [1:621] NA NA NA NA ...
      ..$ is_in.state_code       : chr [1:621] NA NA NA NA ...
      ..$ left.country           : chr [1:621] NA NA NA NA ...
      ..$ leisure                : chr [1:621] NA NA NA NA ...
      ..$ motor_vehicle          : chr [1:621] NA NA NA NA ...
      ..$ name.en                : chr [1:621] NA NA NA NA ...
      ..$ name.es                : chr [1:621] NA NA NA NA ...
      ..$ name.pt                : chr [1:621] NA NA NA NA ...
      ..$ natural                : chr [1:621] NA NA NA NA ...
      ..$ note                   : chr [1:621] NA NA NA NA ...
      ..$ oneway                 : chr [1:621] NA NA NA NA ...
      ..$ operator               : chr [1:621] NA NA NA NA ...
      ..$ ownership              : chr [1:621] NA NA NA NA ...
      ..$ population             : chr [1:621] NA NA NA NA ...
      ..$ procted_class          : chr [1:621] NA NA NA NA ...
      ..$ protect_class          : chr [1:621] NA NA NA NA ...
      ..$ protect_id             : chr [1:621] NA NA NA NA ...
      ..$ protected_area         : chr [1:621] NA NA NA NA ...
      ..$ protection_award       : chr [1:621] NA NA NA NA ...
      ..$ protection_title       : chr [1:621] NA NA NA NA ...
      ..$ ramsar                 : chr [1:621] NA NA NA NA ...
      ..$ ref                    : chr [1:621] NA NA NA NA ...
      ..$ ref.CNUC               : chr [1:621] NA NA NA NA ...
      ..$ ref.Funai              : chr [1:621] NA NA NA NA ...
      ..$ related_law            : chr [1:621] NA NA NA NA ...
      ..$ right.country          : chr [1:621] NA NA NA NA ...
      ..$ route                  : chr [1:621] NA NA NA NA ...
      ..$ seasonal               : chr [1:621] NA NA NA NA ...
      ..$ shape_area             : chr [1:621] NA NA NA NA ...
      ..$ shape_len              : chr [1:621] NA NA NA NA ...
      ..$ source                 : chr [1:621] "IBGE" "IBGE" "IBGE" "IBGE;Bing" ...
      ..$ source.name            : chr [1:621] NA NA NA NA ...
      ..$ source.river           : chr [1:621] NA "Bing" "Bing" NA ...
      ..$ start_date             : chr [1:621] NA NA NA NA ...
      ..$ surface                : chr [1:621] NA NA NA NA ...
      ..$ tipo                   : chr [1:621] NA NA NA NA ...
      ..$ tourism                : chr [1:621] NA NA NA NA ...
      ..$ water                  : chr [1:621] NA NA NA NA ...
      ..$ waterway               : chr [1:621] "river" "river" "river" "river" ...
      ..$ waterway.information   : chr [1:621] NA NA NA NA ...
      ..$ waterway.information.pt: chr [1:621] NA NA NA NA ...
      ..$ website                : chr [1:621] NA NA NA NA ...
      ..$ wikidata               : chr [1:621] NA NA NA NA ...
      ..$ wikipedia              : chr [1:621] NA NA NA NA ...
      ..$ geometry               :sfc_LINESTRING of length 621; first list element:  XY [1:7, 1:2] -57.6 -57.6 -57.6 -57.6 -57.6 ...
      .. ..- attr(*, "dimnames")=List of 2
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:81] "osm_id" "name" "FUNAI.ADR" "FUNAI.AREAETNO" ...
     $ osm_polygons     :Classes ‘sf’ and 'data.frame':	59 obs. of  82 variables:
      ..$ osm_id                 : chr [1:59] "52091672" "114651309" "165348564" "165348565" ...
      ..$ name                   : chr [1:59] "Laguna Concepción" NA NA NA ...
      ..$ FUNAI.ADR              : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.AREAETNO         : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.AREA_HA          : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.CDOC             : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.CODAREA          : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.DATADOC          : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.DOCUMENTO        : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.ETAPA            : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.EXTENSO          : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.FLUXO            : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.GID              : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.GRUPOS           : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.LINKAREA         : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.NOME_AREA        : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.PERIMETRO        : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.SITUACAO         : chr [1:59] NA NA NA NA ...
      ..$ FUNAI.TITULO           : chr [1:59] NA NA NA NA ...
      ..$ IBGE.CD_ADMINIS        : chr [1:59] NA NA NA NA ...
      ..$ IBGE.CD_CLASSE_        : chr [1:59] NA NA NA NA ...
      ..$ admin_level            : chr [1:59] NA NA NA NA ...
      ..$ alt_name               : chr [1:59] NA NA NA NA ...
      ..$ alt_source             : chr [1:59] NA NA NA NA ...
      ..$ area                   : chr [1:59] NA NA NA NA ...
      ..$ boat                   : chr [1:59] NA NA NA NA ...
      ..$ boundary               : chr [1:59] "protected_area" NA "protected_area" "protected_area" ...
      ..$ bridge                 : chr [1:59] NA NA NA NA ...
      ..$ description            : chr [1:59] NA NA NA NA ...
      ..$ destination            : chr [1:59] NA NA NA NA ...
      ..$ embankment             : chr [1:59] NA NA NA NA ...
      ..$ foot                   : chr [1:59] NA NA NA NA ...
      ..$ governance_type        : chr [1:59] NA NA NA NA ...
      ..$ highway                : chr [1:59] NA NA NA NA ...
      ..$ id_areas_e             : chr [1:59] NA NA NA NA ...
      ..$ int_name               : chr [1:59] NA NA NA NA ...
      ..$ intermittent           : chr [1:59] NA NA NA NA ...
      ..$ is_in.city             : chr [1:59] NA NA NA NA ...
      ..$ is_in.state_code       : chr [1:59] NA NA NA NA ...
      ..$ left.country           : chr [1:59] NA NA NA NA ...
      ..$ leisure                : chr [1:59] NA NA NA NA ...
      ..$ motor_vehicle          : chr [1:59] NA NA NA NA ...
      ..$ name.en                : chr [1:59] NA NA NA NA ...
      ..$ name.es                : chr [1:59] NA NA NA NA ...
      ..$ name.pt                : chr [1:59] NA NA NA NA ...
      ..$ natural                : chr [1:59] "water" NA NA NA ...
      ..$ note                   : chr [1:59] NA NA NA NA ...
      ..$ oneway                 : chr [1:59] NA NA NA NA ...
      ..$ operator               : chr [1:59] NA NA NA NA ...
      ..$ ownership              : chr [1:59] NA NA NA NA ...
      ..$ population             : chr [1:59] NA NA NA NA ...
      ..$ procted_class          : chr [1:59] NA NA NA NA ...
      ..$ protect_class          : chr [1:59] NA NA NA NA ...
      ..$ protect_id             : chr [1:59] "900784" NA NA NA ...
      ..$ protected_area         : chr [1:59] NA NA NA NA ...
      ..$ protection_award       : chr [1:59] "Wetlands of International Importance (Ramsar)" NA NA NA ...
      ..$ protection_title       : chr [1:59] "Wetlands of International Importance (Ramsar)" NA NA NA ...
      ..$ ramsar                 : chr [1:59] "yes" NA NA NA ...
      ..$ ref                    : chr [1:59] NA NA NA NA ...
      ..$ ref.CNUC               : chr [1:59] NA NA NA NA ...
      ..$ ref.Funai              : chr [1:59] NA NA NA NA ...
      ..$ related_law            : chr [1:59] NA NA NA NA ...
      ..$ right.country          : chr [1:59] NA NA NA NA ...
      ..$ route                  : chr [1:59] NA NA NA NA ...
      ..$ seasonal               : chr [1:59] NA NA NA NA ...
      ..$ shape_area             : chr [1:59] NA NA NA NA ...
      ..$ shape_len              : chr [1:59] NA NA NA NA ...
      ..$ source                 : chr [1:59] NA NA NA NA ...
      ..$ source.name            : chr [1:59] NA NA NA NA ...
      ..$ source.river           : chr [1:59] NA NA NA NA ...
      ..$ start_date             : chr [1:59] NA NA NA NA ...
      ..$ surface                : chr [1:59] NA NA NA NA ...
      ..$ tipo                   : chr [1:59] NA NA NA NA ...
      ..$ tourism                : chr [1:59] NA NA NA NA ...
      ..$ water                  : chr [1:59] "lake" NA NA NA ...
      ..$ waterway               : chr [1:59] NA NA NA NA ...
      ..$ waterway.information   : chr [1:59] NA NA NA NA ...
      ..$ waterway.information.pt: chr [1:59] NA NA NA NA ...
      ..$ website                : chr [1:59] NA NA NA NA ...
      ..$ wikidata               : chr [1:59] "Q868663" NA NA NA ...
      ..$ wikipedia              : chr [1:59] "es:Laguna Concepción" NA NA NA ...
      ..$ geometry               :sfc_POLYGON of length 59; first list element: List of 1
      .. ..$ : num [1:145, 1:2] -61.4 -61.4 -61.4 -61.4 -61.4 ...
      .. .. ..- attr(*, "dimnames")=List of 2
      .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:81] "osm_id" "name" "FUNAI.ADR" "FUNAI.AREAETNO" ...
     $ osm_multilines   : NULL
     $ osm_multipolygons:Classes ‘sf’ and 'data.frame':	86 obs. of  53 variables:
      ..$ osm_id                : chr [1:86] "2525280" "2670411" "2670412" "2670422" ...
      ..$ name                  : chr [1:86] "Parque Nacional das Emas" "Cacique Fontoura" "Terra Indígena Kayabi" "Utaria Wyhyna/Iròdu Iràna" ...
      ..$ FUNAI.ADR             : chr [1:86] "" "São Félix do Araguaia" "" "Gurupi" ...
      ..$ FUNAI.AREAETNO        : chr [1:86] "" "I" "" "I" ...
      ..$ FUNAI.AREA_HA         : chr [1:86] "" "32304.7226" "" "177466" ...
      ..$ FUNAI.CDOC            : chr [1:86] "" "Memora Dem" "" "Port Decl" ...
      ..$ FUNAI.CODAREA         : chr [1:86] "" "58701" "" "62401" ...
      ..$ FUNAI.DATADOC         : chr [1:86] "" "2010-03-31 00:00:00" "" "2010-11-03 00:00:00" ...
      ..$ FUNAI.DOCUMENTO       : chr [1:86] "" "Memo/CGD - Libera peças técnicas" "" "Portaria Declaratória" ...
      ..$ FUNAI.ETAPA           : chr [1:86] "" "Processo de homologação" "" "Planejamento demarcação" ...
      ..$ FUNAI.EXTENSO         : chr [1:86] "" "Principal" "" "Principal" ...
      ..$ FUNAI.FLUXO           : chr [1:86] "" "305" "" "230" ...
      ..$ FUNAI.GID             : chr [1:86] "" "527" "" "11" ...
      ..$ FUNAI.GRUPOS          : chr [1:86] "" "Karajá" "" "Javaé, Karajá" ...
      ..$ FUNAI.LINKAREA        : chr [1:86] "" "TI Cacique Fontoura" "" "TI Utaria Wyhyna/Iròdu Iràna" ...
      ..$ FUNAI.NOME_AREA       : chr [1:86] "" "Cacique Fontoura" "" "Utaria Wyhyna/Iròdu Iràna" ...
      ..$ FUNAI.PERIMETRO       : chr [1:86] "" "116.87674" "" "331" ...
      ..$ FUNAI.REV             : chr [1:86] "" "" "" "" ...
      ..$ FUNAI.SITUACAO        : chr [1:86] "" "Declarada" "" "Declarada" ...
      ..$ FUNAI.TITULO          : chr [1:86] "" "Memorando nº 37/CGGEO/2010" "" "Portaria nº 3574, de 3 de novembro de 2010" ...
      ..$ boundary              : chr [1:86] "protected_area" "protected_area" "protected_area" "protected_area" ...
      ..$ description           : chr [1:86] "" "" "" "" ...
      ..$ ethnic_group          : chr [1:86] "" "" "Apiaká/Koyabi, Kayabi, Munduruku" "" ...
      ..$ governance_type       : chr [1:86] "" "" "" "" ...
      ..$ is_in.city            : chr [1:86] "" "Luciara;São Félix do Araguaia" "" "Pium" ...
      ..$ is_in.state_code      : chr [1:86] "" "MT" "" "TO" ...
      ..$ leisure               : chr [1:86] "" "" "" "" ...
      ..$ natural               : chr [1:86] "" "" "" "" ...
      ..$ official_name         : chr [1:86] "" "" "" "" ...
      ..$ operator              : chr [1:86] "Instituto Chico Mendes de Conservação da Biodiversidade" "" "Fundação Nacional do Índio" "" ...
      ..$ ownership             : chr [1:86] "" "" "" "" ...
      ..$ population            : chr [1:86] "" "489" "" "0" ...
      ..$ protect_class         : chr [1:86] "2" "" "24" "" ...
      ..$ protected_area        : chr [1:86] "" "political" "" "political" ...
      ..$ protection_object     : chr [1:86] "" "" "" "" ...
      ..$ protection_title      : chr [1:86] "parque nacional" "Terra Indígena" "terra indígena" "Terra Indígena" ...
      ..$ ramsar                : chr [1:86] "" "" "" "" ...
      ..$ ref.CNUC              : chr [1:86] "00.0000.0155" "" "" "" ...
      ..$ ref.Funai             : chr [1:86] "" "" "22902" "" ...
      ..$ ref.sernap            : chr [1:86] "" "" "" "" ...
      ..$ related_law           : chr [1:86] "DEC 49.874 de 11/01/1961" "" "" "" ...
      ..$ short_name            : chr [1:86] "" "" "" "" ...
      ..$ short_protection_title: chr [1:86] "" "" "" "" ...
      ..$ site_ownership        : chr [1:86] "" "" "" "" ...
      ..$ site_status           : chr [1:86] "" "" "" "" ...
      ..$ source                : chr [1:86] "ICMBio" "Funai" "Funai" "Funai" ...
      ..$ source.date           : chr [1:86] "" "" "" "" ...
      ..$ start_date            : chr [1:86] "1961" "" "" "" ...
      ..$ type                  : chr [1:86] "multipolygon" "boundary" "multipolygon" "multipolygon" ...
      ..$ website               : chr [1:86] "" "" "" "" ...
      ..$ wikidata              : chr [1:86] "Q752218" "" "" "" ...
      ..$ wikipedia             : chr [1:86] "pt:Parque Nacional das Emas" "" "" "" ...
      ..$ geometry              :sfc_MULTIPOLYGON of length 86; first list element: List of 1
      .. ..$ :List of 1
      .. ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
      ..- attr(*, "sf_column")= chr "geometry"
      ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
      .. ..- attr(*, "names")= chr [1:52] "osm_id" "name" "FUNAI.ADR" "FUNAI.AREAETNO" ...
     - attr(*, "class")= chr [1:3] "list" "osmdata" "osmdata_sf"


Now we are ready to start making some plots. First we extract a background "satellite" map for our region of interest. Let's take a look at both, farm and protected areas.   


```R
MG_bg_map <- MG_bb %>%
    get_map(maptype = "satellite")
```

    Source : http://tile.stamen.com/terrain/6/21/33.png
    Source : http://tile.stamen.com/terrain/6/22/33.png
    Source : http://tile.stamen.com/terrain/6/23/33.png
    Source : http://tile.stamen.com/terrain/6/21/34.png
    Source : http://tile.stamen.com/terrain/6/22/34.png
    Source : http://tile.stamen.com/terrain/6/23/34.png
    Source : http://tile.stamen.com/terrain/6/21/35.png
    Source : http://tile.stamen.com/terrain/6/22/35.png
    Source : http://tile.stamen.com/terrain/6/23/35.png



```R
MG_bg_map %>% ggmap()+
  geom_sf(data=MG_farmland$osm_polygons,
          inherit.aes =FALSE,
          aes(fill="Farmland"),
          alpha=.5,
          size=0.1, show.legend = "polygon")+
  geom_sf(data=MG_protected$osm_polygons,
          inherit.aes =FALSE,
          aes(fill="Protected Area"),
          alpha=.5,
          size=0.1, show.legend = "polygon")+
  scale_fill_manual(values = c("Farmland" = "blue", "Protected Area" = "purple")) +
  labs(x="",y="")
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_49_1.png)


It looks like in some parts the farms and the protected areas are very close to each other, in some cases they almost overlap. What about the fires? Let's bring them to our plot. 
The function coord_sf allows us to define the coordinate system that will be used within our plotting functions, in this case we use it to ensure that all of the layers of our plot are based on the same coordinate system. We will assign a color aesthetic to our Fire Radiative Power (rfp) attribute.


```R
MG_bg_map <- "STATE OF MATO GROSSO" %>%
    getbb() %>%
    get_map(maptype = "terrain")
```


```R
ggmap(MG_bg_map) + 
    coord_sf(crs = st_crs(4326)) +
    geom_sf(data=MG_farmland$osm_polygons,
          inherit.aes =FALSE,
          aes(fill="Farmland"),
          alpha=.5,
          size=0.1, show.legend = "polygon")+
  geom_sf(data=MG_protected$osm_polygons,
          inherit.aes =FALSE,
          aes(fill="Protected Area"),
          alpha=.5,
          size=0.1, show.legend = "polygon")+
  scale_fill_manual(values = c("Farmland" = "blue", "Protected Area" = "purple")) +
  geom_sf(data=fire_MG_sf, aes(color = frp),inherit.aes = FALSE) +
  scale_color_gradient(low="yellow", high="red") 
```

    Coordinate system already present. Adding new coordinate system, which will replace the existing one.
    Coordinate system already present. Adding new coordinate system, which will replace the existing one.



![png](output_52_1.png)


This notebook a only a brief introduction to mapping in R. If you are more interested in these topics and want to dig deeper into geographic data analysis I suggest you check out the following [Geocomputation with R](geocompr.robinlovelace.net) . It was recently released, is open source and has lots of examples using New Zealand as a case of study.  
